# Smart Adaptive Visual Tracer

This project is part of a bachelor thesis focused on enhancing program debugging and understanding through an innovative visual tracing system. The system incorporates rule-based options and leverages large language models (LLMs) to dynamically adapt to user interactions and specific needs. It provides intuitive visual feedback through animations of various data structures, such as arrays, trees, and graphs, making the debugging process more engaging and informative.

## Project Overview

The Smart Adaptive Visual Tracer system analyzes Python code execution in real-time, tracks changes in fundamental data structures (arrays, trees, graphs), and selects appropriate visualization techniques to enhance program comprehension and debugging. By integrating deterministic code tracing with the analytical capabilities of Mistral AI for visualization selection, the system offers customized tracing options adaptable to different programming scenarios, proving particularly effective for understanding complex software environments.

## System Architecture

The project consists of two main components: a consolidated Python Flask backend server and a React frontend.

### 1. Consolidated Backend Server (`visual_tracer_backend/`)
**Role:** This component is a self-contained Flask application responsible for all backend logic, including code tracing, data processing, LLM interaction, and API provision.

**Functionality:**
-   **Code Tracing (`app/tracer.py`):**
    -   Receives Python code snippets via API calls.
    -   Utilizes Python's `sys.settrace` function to intercept execution events (line execution, function calls, returns) within the same application process.
    -   Identifies and tracks the state changes of fundamental data structures (lists identified as arrays, specific object patterns identified as trees, dictionary patterns identified as graphs) during the code's execution.
    -   Records a detailed history of operations (creation, modification, access) performed on these tracked data structures.
    -   Serializes the captured trace data into a structured JSON format.
-   **Data Processing (`app/data_processor.py`):**
    -   Performs filtering and processing on the raw trace data generated by the tracer to prepare it for visualization and LLM analysis. This step reduces noise and focuses on significant state changes.
-   **LLM Interaction (`app/llm_handler.py`):**
    -   Sends the processed trace data for each structure type (arrays, trees, graphs) to the Mistral AI LLM.
    -   The LLM's task is to analyze the trace data and determine the most effective visualization technique (e.g., Timeline Array vs. Element Focused for arrays).
-   **API Endpoints (`app/routes.py`):**
    -   Provides RESTful API endpoints for the React frontend to submit code and retrieve analysis results (including filtered trace data and LLM visualization recommendations).
    -   Manages an in-memory store for the results of the latest analysis to serve subsequent data requests from the frontend, simplifying data handling.

### 2. React Frontend (`frontend/`)
**Role:** Provides the user interface for code input, interaction, and visualization.

**Functionality:**
-   A code input interface for submitting Python snippets.
-   Communicates with the Flask backend via REST API calls to submit code (`/api/analyze`) and fetch processed data and visualization recommendations (e.g., `/api/execution_data`, `/api/visualization/<data_type>`).
-   Renders interactive visualizations of arrays, trees, and graphs based on the data received and the visualization type recommended by the LLM.
-   Uses D3.js to create detailed, animated visualizations:
    -   **ArrayVisualizer**: Timeline array, element-focused, and array comparison views.
    -   **TreeVisualizer**: Hierarchical and radial tree visualizations.
    -   **GraphVisualizer**: Force-directed and adjacency matrix representations.
-   Provides playback controls (play, pause, step) to allow users to step through the execution trace and observe data structure changes over time.
-   Displays contextual information about operations being performed at each step.

## Requirements

-   **Python**: 3.9+ (3.13.2 recommended, ensure compatibility with Flask and Mistral AI SDK)
-   **Node.js**: v18.x, v20.x, or v22.x (v22.14.0 used in development, any recent LTS version should be fine)
-   **Mistral AI**: API key required
-   **Modern web browser**: Chrome, Firefox, or Edge recommended

## Detailed Setup Instructions

Follow these step-by-step instructions to set up and run the project:

### Step 1: Backend Server Setup (`visual_tracer_backend/`)

1.  Open a terminal (Command Prompt, PowerShell, Terminal, etc.) and navigate to the backend server directory. If your project root contains both `frontend` and `visual_tracer_backend`, navigate into `visual_tracer_backend`:
    ```bash
    cd path/to/your_project/visual_tracer_backend
    ```

2.  Create a Python virtual environment. This is highly recommended to manage dependencies and avoid conflicts.
    * On macOS/Linux:
        ```bash
        python3 -m venv .venv
        source .venv/bin/activate
        ```
    * On Windows:
        ```bash
        python -m venv .venv
        .\.venv\Scripts\activate
        ```
    *(Your terminal prompt should change to indicate the virtual environment is active, e.g., `(.venv)`)*

3.  Install required Python dependencies:
    ```bash
    pip install Flask Flask-CORS "mistralai==0.0.8" python-dotenv
    ```
    > **Dependencies explained**:
    > - `Flask`, `Flask-CORS`: For creating the API server and handling cross-origin requests from the frontend.
    > - `mistralai==0.0.8`: The specific version of the Mistral AI client used for determining optimal visualization types. (You can try the latest `mistralai` if preferred, but ensure compatibility with the existing LLM handler code).
    > - `python-dotenv`: Enables loading environment variables (like your API key) from a `.env` file.

4.  Create a `.env` file in the `visual_tracer_backend/` directory. This file will store your Mistral AI API key.
    Add the following line to the `.env` file:
    ```
    MISTRAL_API_KEY=your_actual_mistral_api_key_here
    ```
    **⚠️ Important**: Replace `your_actual_mistral_api_key_here` with your real Mistral AI API key. This step is crucial for the visualization selection to work properly.

5.  Start the Flask backend server:
    ```bash
    python run.py
    ```
    The server should start, typically on `http://127.0.0.1:8000` (or as configured by environment variables `FLASK_RUN_HOST`/`FLASK_RUN_PORT`). The terminal will show log messages indicating it's ready to handle requests from the frontend.

### Step 2: Frontend Setup (`frontend/`)

1.  Open a *new* terminal window or tab (keep the backend server running in its own terminal).
2.  Navigate to the frontend directory:
    ```bash
    cd path/to/your_project/frontend
    ```

3.  Install Node.js dependencies (if you haven't already or if the `node_modules` directory is missing):
    ```bash
    npm install
    ```

4.  Start the React development server:
    ```bash
    npm start
    ```
    The frontend application should open automatically in your default web browser, usually at `http://localhost:3000`.

## System Usage

Once both the backend server (`visual_tracer_backend`) and the frontend development server (`frontend`) are running:

1.  Open your web browser to the frontend URL (typically `http://localhost:3000`).
2.  Enter your Python code in the code input panel on the left.
3.  Click the "Analyze Code" button to submit the code for processing by the backend.
4.  After analysis, the visualization area on the right will update. Navigate between the "Arrays", "Trees", and "Graphs" tabs to see the different visualizations.
5.  Use the playback controls (play, pause, step forward/backward, speed slider) to step through the execution trace.
6.  Hover over elements in the D3.js visualizations for additional information and tooltips.
7.  Observe the "Operation Details" section below the visualization to understand the specific line of code responsible for each visual change in the data structure.

## Troubleshooting

### Backend Server Issues (`visual_tracer_backend/`)
-   **Python Version**: Ensure you're using Python 3.9+ (3.13.2 was used in development).
-   **Virtual Environment**: Double-check that the virtual environment is activated before running `pip install ...` or `python run.py`. Your terminal prompt should indicate this (e.g., `(.venv)`).
-   **Dependencies**: Verify that all Python dependencies (`Flask`, `Flask-CORS`, `mistralai`, `python-dotenv`) were installed successfully within the virtual environment. If in doubt, try reinstalling them: `pip install --force-reinstall Flask Flask-CORS "mistralai==0.0.8" python-dotenv`.
-   **Mistral API Key**: Confirm that your `MISTRAL_API_KEY` is correctly set in the `.env` file located directly within the `visual_tracer_backend/` directory and that the file is named exactly `.env` (not `.env.txt` or similar).
-   **Server Logs**: Look for any error messages or tracebacks in the terminal where `python run.py` is executing. These often provide clues about what went wrong (e.g., issues initializing the Mistral client, problems during tracing).
-   **Port Conflicts**: Ensure port 8000 (or the port you configured via `FLASK_RUN_PORT`) is not already in use by another application.

### Frontend Issues (`frontend/`)
-   **Node.js Version**: Ensure you have a compatible Node.js version (e.g., v18.x, v20.x, v22.x).
-   **Node.js Dependencies**: Make sure all Node.js dependencies are installed by running `npm install` in the `frontend` directory. If you encounter issues, try deleting the `node_modules` folder and `package-lock.json` file, then run `npm install` again.
-   **Backend Server Running**: Verify the Flask backend server is running and accessible (typically on `http://127.0.0.1:8000`). You can test this by trying to access `http://127.0.0.1:8000/test` in your browser (it should return `{"status":"ok from new backend"}`).
-   **Browser Console**: Open your browser's developer console (usually by pressing F12) and check for any JavaScript errors or network request failures (e.g., 404s or 500s when the frontend tries to call the backend API).
-   **CORS Issues**: While `Flask-CORS` is configured for `/api/*` routes, if you see CORS errors specifically for API calls, double-check the CORS setup in `app/__init__.py` and ensure your frontend is making requests to the correct backend URL and port.

## Project Components in Detail

### Backend Server (`visual_tracer_backend/app/`)
The backend is a Flask application structured for clarity and maintainability:
-   **`__init__.py`**: Initializes the Flask application using an app factory pattern. It sets up configurations like CORS and loads environment variables from the `.env` file.
-   **`tracer.py`**: Contains the core `sys.settrace` logic. This module is responsible for hooking into Python code execution, identifying arrays, trees, and graphs, and meticulously tracking their state changes and operations in real-time.
-   **`data_processor.py`**: Takes the raw execution trace data from `tracer.py` and filters it. This crucial step selects only the significant events and prepares the data in a clean format suitable for visualization and further analysis by the LLM.
-   **`llm_handler.py`**: Manages all interactions with the Mistral AI API. It receives processed data structure traces and sends carefully crafted prompts to the LLM to get recommendations for the most suitable visualization types for each data structure.
-   **`routes.py`**: Defines all the RESTful API endpoints that the React frontend consumes (e.g., `/api/analyze`, `/api/execution_data`). It orchestrates the calls to the tracer, data processor, and LLM handler. It also serves the static files for the React frontend.
-   **`run.py`** (located in the parent `visual_tracer_backend/` directory): This is the main script used to start the Flask development server.

### React Frontend (`frontend/src/components/`)
The frontend is built with React and uses D3.js for dynamic visualizations. Key components include:
-   **`App.js`**: The main application component that structures the layout (header, code input column, visualization column, footer) and manages overall state like analysis completion and active visualization tab.
-   **`CodeInput.js`**: Provides the text area for users to input Python code and handles the submission to the backend API, including loading states and error/success messages.
-   **Visualizer Components**:
    -   **`ArrayVisualizer.js`**: Renders array data structures. It supports multiple views like a timeline of changes, an element-focused view highlighting modifications, and a comparison view for multiple arrays.
    -   **`TreeVisualizer.js`**: Displays tree structures. It offers both traditional hierarchical layouts and radial layouts for different perspectives on tree data.
    -   **`GraphVisualizer.js`**: Represents graph data. It can show graphs using a force-directed layout (good for understanding structure and relationships) or as an adjacency matrix (useful for dense graphs). It also includes a graph statistics display.

Each visualizer component is designed to be interactive, allowing users to:
-   Control playback of the execution trace (play, pause, step forward/backward, speed adjustment via slider and buttons).
-   See changes highlighted with distinct color-coding and animations.
-   Hover over elements in the D3.js visualizations to get tooltips with detailed information.
-   View the specific line of code ("Operation Details") that caused each visual change in the data structure.

## License

This project is part of a bachelor thesis and is available for educational purposes.

## Acknowledgments

This project utilizes several open-source libraries and tools, including:
-   D3.js for data visualization
-   React for frontend development
-   Flask for API development
-   Mistral AI for intelligent visualization selection
-   Python's built-in `sys` and `linecache` modules for code tracing.